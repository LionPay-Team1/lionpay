# 0) Ï≤òÏùåÏóî ÏÑúÏö∏ Î¶¨Ï†ÑÏúºÎ°ú AWS Î°úÍ∑∏Ïù∏
- name: Configure AWS credentials (Seoul)
  uses: aws-actions/configure-aws-credentials@v4
  with:
    role-to-assume: arn:aws:iam::727646470302:role/lionpay-role
    aws-region: ap-northeast-2

# 1) Build
- name: Build Docker image (auth)
  run: |
    docker build \
      -f lionpay-auth/Dockerfile \
      -t ${{ env.ECR_REPOSITORY }}:${{ env.IMAGE_TAG }} \
      .

# 2) Seoul ECR
- name: Login to Amazon ECR (Seoul)
  id: login-seoul
  uses: aws-actions/amazon-ecr-login@v2

- name: Push to Amazon ECR (Seoul)
  run: |
    docker tag ${{ env.ECR_REPOSITORY }}:${{ env.IMAGE_TAG }} \
      ${{ steps.login-seoul.outputs.registry }}/${{ env.ECR_REPOSITORY }}:${{ env.IMAGE_TAG }}
    docker push ${{ steps.login-seoul.outputs.registry }}/${{ env.ECR_REPOSITORY }}:${{ env.IMAGE_TAG }}

    docker tag ${{ env.ECR_REPOSITORY }}:${{ env.IMAGE_TAG }} \
      ${{ steps.login-seoul.outputs.registry }}/${{ env.ECR_REPOSITORY }}:latest
    docker push ${{ steps.login-seoul.outputs.registry }}/${{ env.ECR_REPOSITORY }}:latest

# üîÅ Ïó¨Í∏∞ÏÑú Î¶¨Ï†ÑÏùÑ ‚ÄúÎèÑÏøÑÎ°ú Îã§Ïãú Î°úÍ∑∏Ïù∏‚Äù
- name: Configure AWS credentials (Tokyo)
  uses: aws-actions/configure-aws-credentials@v4
  with:
    role-to-assume: arn:aws:iam::727646470302:role/lionpay-role
    aws-region: ap-northeast-1

# 3) Tokyo ECR
- name: Login to Amazon ECR (Tokyo)
  id: login-tokyo
  uses: aws-actions/amazon-ecr-login@v2

- name: Push to Amazon ECR (Tokyo)
  run: |
    docker tag ${{ env.ECR_REPOSITORY }}:${{ env.IMAGE_TAG }} \
      ${{ steps.login-tokyo.outputs.registry }}/${{ env.ECR_REPOSITORY }}:${{ env.IMAGE_TAG }}
    docker push ${{ steps.login-tokyo.outputs.registry }}/${{ env.ECR_REPOSITORY }}:${{ env.IMAGE_TAG }}

    docker tag ${{ env.ECR_REPOSITORY }}:${{ env.IMAGE_TAG }} \
      ${{ steps.login-tokyo.outputs.registry }}/${{ env.ECR_REPOSITORY }}:latest
    docker push ${{ steps.login-tokyo.outputs.registry }}/${{ env.ECR_REPOSITORY }}:latest
