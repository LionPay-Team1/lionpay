# 라이언 페이 (LionPay)

## 기능/비기능 요구사항

### 전제 조건
- 대한민국 이용자 대상
- 포인트는 원화로 충전
- 외국에서 결제 시 결제 시점의 환율을 반영해서 결제

---

### 기능 요구사항 (Functional Requirements)

#### Must (MVP에 반드시 포함)
- **회원가입/로그인**
  - As a 사용자, I want 회원가입을 하고 로그인하고 싶다 so that 내 포인트와 거래 내역을 안전하게 관리할 수 있다.
- **포인트 충전**
  - As a 사용자, I want 포인트를 충전하고 싶다 so that 포인트로 결제를 할 수 있다.
- **포인트 결제**
  - As a 사용자, I want 포인트를 차감하여 결제하고 싶다 so that 상품이나 서비스를 구매할 수 있다.
- **잔액 확인**
  - As a 사용자, I want 현재 내 포인트 잔액을 실시간으로 확인하고 싶다 so that 결제 가능 여부를 바로 판단할 수 있다.
- **거래 내역 확인**
  - As a 사용자, I want 내 포인트 거래 내역을 확인하고 싶다 so that 언제 어디서 사용했는지 추적할 수 있다.
- **관리자 조회**
  - As an 관리자, I want 전체 사용자 포인트 현황을 조회하고 싶다 so that 서비스 운영 상태를 한눈에 파악할 수 있다.
- **리전 장애 확인**
  - As an 관리자, I want 리전 장애 여부를 확인하고 싶다 so that 서비스 장애를 빠르게 인지하고 대응할 수 있다.

#### Should (시간이 허락되면 포함)
- **해외 결제**
  - As a 여행자, I want 국내에서 적립한 포인트를 해외에서 사용하고 싶다 so that 국내에서 적립한 포인트를 소비하기 위해
- **포인트 통합**
  - As a 일반 소비자, I want 포인트를 통합하여 관리하고 싶다 so that 포인트 관리를 편하게 하기 위해
- **환율 미리보기**
  - As a 회원, I want 한국돈으로 충전시 일본돈으로 환율계산하여 얼마가 충전되는지 so that 충전하기전 자동 환율계산하여 환전금 미리보기

#### Could (고도화 단계, 선택 구현)
- **성능 최적화**
  - As a 서비스 이용자, I want 서비스 속도가 빨랐으면 좋겠다 so that 빠르게 결제하기 위해
- **알림 서비스**
  - As a 사용자, I want 최근 사용 내역을 알림으로 받고 싶다 so that 비정상 결제를 빠르게 인지할 수 있다.

---

### 비기능 요구사항 (Non-Functional Requirements)

#### 성능 (Performance)
- **QPS**: 피크 시간 기준 QPS 50 요청 처리 가능
  - *QPS = Queries Per Second, 서버가 1초에 처리할 수 있는 요청(Request) 수*
  - *1초에 최대 50건의 포인트 충전/조회 요청을 동시에 처리할 수 있어야 함*
- **응답 시간**: P95 API 응답시간 700ms 이하
  - *P95 = 95 Percentile (대부분의 사용자(95%)는 0.7초 이내 응답)*
- **트랜잭션**: 포인트 충전/차감 트랜잭션 1초 이내 반영

#### 가용성 (Availability)
- 업무 시간(09~18시) 기준 가용성 99% 이상
- 서울 리전 장애 시 도쿄 리전으로 3초 이내 Failover

#### 보안 (Security)
- **인증/인가**: JWT 기반 인증, Role 기반 권한 관리(Admin/User)
- **암호화**: 비밀번호 BCrypt 암호화
- **Secrets 관리**: Kubernetes Secret 또는 AWS Secrets Manager
- **통신 보안**: 모든 API 통신 HTTPS 적용

#### 확장성 (Scalability)
- 트래픽 증가 시 Pod Auto Scaling(HPA) 적용
- Karpenter로 빠른 노드 확장
- EKS 기반 수평 확장 구조
- ALB 기반 로드 밸런싱

#### DR (Disaster Recovery)
- **백업**: DB 정기 백업 (일 1회 자동 백업)
- **장애 대응**: 리전 장애 발생 시 도쿄 리전 서비스 전환
- **RTO (장애 복구 시점 목표)**: 3분 이내
- **RPO (데이터 손실 허용 범위)**: 1분 이내

#### 모니터링/로그 (Monitoring & Logging)
- **메트릭**: API 요청 수, 응답 시간(P95), 에러율(4xx/5xx), CPU/Memory 사용률
- **로그**: 요청/응답 로그, 에러 로그
- **트레이싱**: 사용자 요청 → API → DB 전체 흐름 추적
- **알람**: Error Rate 5% 초과 시, 응답 시간 1초 초과 시 알림

#### 운영 (Operations)
- **CI/CD**: 자동 빌드/배포
- **IaC**: Terraform을 이용한 인프라 코드화